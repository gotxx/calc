!function(h){"use strict";function t(){this.setup(),this.initSliders(),this.getCurrencyData(),this.events()}t.prototype={setup:function(){this.state={currency:"PLN"},this.$app=h("#calc"),this.$total=h("#totalCost"),this.$slidersWrappers=h(".js-slider"),this.$sliders=h("[data-slider]"),this.$currencySwitch=h("#currencySwitch"),this.$sliderOutput=h("[data-binding]"),this.diff=h.Deferred(),this.sliderArray=[]},initSliders:function(){var t=this,e={};this.$sliders.each(function(){t.sliderArray.push(new Foundation.Slider(h(this),{dataChangedDelay:0})),t.setupSliderData(h(this))}),t.isDefined(t.state.grossInvoice)&&(e=t.state.grossInvoice),t.setState({grossInvoiceInPln:e},"set initial PLN state")},setupSliderData:function(t){var e={},a=t.find('input[type="hidden"]'),s=t.find("[aria-controls]").attr("aria-controls"),i=a.val(),r="grossInvoice"===s?" brutto":"";this.updateLabels({$slider:t,labelLeftTpl:"<strong>"+t.data("start")+"</strong> <span>"+t.data("label")+"</span>",labelRightTpl:"<strong>"+t.data("end")+"</strong> <span>"+t.data("label")+"</span>",sliderOutputTpl:t.data("label")+r}),e[s]={currentValue:+i,minValue:+a.attr("min"),maxValue:+a.attr("max"),step:+a.attr("step")},this.setState(e,s+" slider setup")},updateLabels:function(t){var e=t.$slider.find(".js-label-left"),a=t.labelLeftTpl,s=t.$slider.find(".js-label-right"),i=t.labelRightTpl,r=t.$slider.parents(".js-slider").next().find(".js-label"),n=t.sliderOutputTpl;e.html(a),s.html(i),r.html(n)},updateSlider:function(t,e){var a=this.sliderArray[t].options;this.sliderArray[t].options=Object.assign({},a,e)},events:function(){var n=this;this.$slidersWrappers.on("click",".js-btn",{self:this},this.sliderBtnHandler),this.$currencySwitch.on("change",{self:this},this.currencySwitchHandler),this.$sliders.on("changed.zf.slider",function(t){var e=h(this),a={},s=e.find('input[type="hidden"]'),i=e.find("[aria-controls]").attr("aria-controls"),r=s.val();return h('[data-binding="'+i+'"]').val(+r),a[i]={currentValue:+r,minValue:+s.attr("min"),maxValue:+s.attr("max"),step:+s.attr("step"),curr:n.state.currency},n.setState(a,i+" changed.zf.slider"),!1}),this.$sliderOutput.on("change",this.outputHandler),this.$app.on("stateUpdate",{self:this},this.stateUpdateHandler)},outputHandler:function(){var t=h("#"+h(this).data("binding")),e=t.parents("[data-slider]");t.val(h(this).val()),e.foundation("_reflow")},sliderBtnHandler:function(t){t.data.self;var e,a=h(this),s=+a.data("value"),i=a.parents(".js-slider"),r=i.find("[data-slider]"),n=i.find("[aria-controls]").attr("aria-controls"),l=h("#"+n),o=+l.val(),d=+l.attr("min"),c=+l.attr("max"),u=r.data("step");return s&&o<c&&(e=o+u,l.val(e),r.foundation("_reflow")),!s&&d<o&&(e=o-u,l.val(e),r.foundation("_reflow")),!1},setState:function(t,e){this.state=Object.assign({},this.state,t),this.$app.trigger("stateUpdate",[{caller:e}])},stateUpdateHandler:function(t,e){t.data.self.calculateTotalCost(e)},currencySwitchHandler:function(t){var e=t.data.self,a=t.data.initial,s=h(this).is(":checked"),i=s?"EURO":"PLN",r=s?e.state.grossInvoiceInEuro:e.state.grossInvoiceInPln,n=e.sliderArray[0].$element;e.updateLabels({$slider:n,labelLeftTpl:"<strong>"+r.minValue+"</strong> <span>"+i+"</span>",labelRightTpl:"<strong>"+r.maxValue+"</strong> <span>"+i+"</span>",sliderOutputTpl:i+" brutto"}),e.setState({currency:i},"currencySwitchHandler-setCurrency"),e.updateGrossInvoiceSlider(s,a),Foundation.reInit(h(h("[data-slider]")[0]))},recalculate:function(){var t=(this.state.grossInvoice.currentValue/this.state.euroRate).toFixed(2),e=(this.state.grossInvoice.maxValue/this.state.euroRate).toFixed(0),a=(this.state.grossInvoice.minValue/this.state.euroRate).toFixed(0);return{}.grossInvoiceInEuro={currentValue:+t,minValue:+a,maxValue:+e,step:+this.state.grossInvoice.step}},updateGrossInvoiceSlider:function(t,e){var a=t?this.state.grossInvoiceInEuro:this.state.grossInvoiceInPln,s=+h("#grossInvoice").val(),i=t?(s/this.state.euroRate).toFixed(2):this.isDefined(e)?s.toFixed(2):(s*this.state.euroRate).toFixed(2);this.isDefined(a)&&this.updateSlider(0,{start:+a.minValue,end:+a.maxValue,step:+a.step,initialStart:i,initialEnd:+a.step})},getData:function(t){return h.get(t)},getCurrencyData:function(){var e=this,t=this.getData("https://api.nbp.pl/api/exchangerates/rates/A/EUR/today/");t.done(function(t){e.setState({euroRate:t.rates[0].mid.toFixed(2)}," tableAData - set currency"),e.$currencySwitch.removeAttr("disabled").removeClass("disabled"),e.isDefined(e.state.grossInvoice)&&e.setState({grossInvoiceInEuro:e.recalculate()}," recalculate by tableAData"),e.currencySwitchHandler({data:{self:e,initial:!0}})}),t.fail(function(t){console.warn(t.statusText),e.diff.reject(t)}),this.diff.fail(function(t){e.tableCData=e.getData("https://api.nbp.pl/api/exchangerates/rates/C/EUR/today/"),e.tableCData.done(function(t){e.setState({euroRate:t.rates[0].ask}," tableCData - set currency"),e.$currencySwitch.removeAttr("disabled").removeClass("disabled"),e.isDefined(e.state.grossInvoice)&&e.setState({grossInvoiceInEuro:e.recalculate()}," recalculate by tableCData")})})},calculateTotalCost:function(t){if(this.isDefined(this.state.grossInvoice)&&this.isDefined(this.state.paymentDeadline)){var e=+this.state.paymentDeadline.currentValue,a=this.state.grossInvoice.currentValue,s=("EURO"===this.state.currency?(a*this.state.euroRate).toFixed(2):a)*(.1*e).toFixed(1)/100,i=s<50?50:+s;"currencySwitchHandler-setCurrency"!==t.caller&&this.$total.html("<strong>"+i.toFixed(2)+"</strong> PLN")}},isDefined:function(t){return void 0!==t}},h(function(){new t})}(jQuery);
//# sourceMappingURL=app.min.js.map
